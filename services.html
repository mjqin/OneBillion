<!DOCTYPE html>
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<title>一个小目标</title>
		<meta name="description" content="">
		<meta name="author" content="">

		<!-- Mobile Meta -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- Favicon -->
		<link rel="shortcut icon" href="images/favicon.ico">
 
		<link href="bootstrap/css/bootstrap.css" rel="stylesheet"> 
		<link href="fonts/font-awesome/css/font-awesome.css" rel="stylesheet"> 
		<link href="css/animations.css" rel="stylesheet"> 
		<link href="css/style.css" rel="stylesheet"> 
		<link href="css/custom.css" rel="stylesheet">
		<link rel="Stylesheet" href="css/loginDialog.css" />

		<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
		<script type="text/javascript" src="js/nebPay.js"></script>
		<script type="text/javascript" src="js/sha256.js"></script>
	</head>

	<body class="no-trans">
		<!-- scrollToTop --> 
		<div class="scrollToTop"><i class="icon-up-open-big"></i></div>

		<!-- header start --> 
		<header class="header fixed clearfix navbar navbar-fixed-top">
			<div class="container">
				<div class="row">
					<div class="col-md-4">

						<!-- header-left start --> 
						<div class="header-left">

							<!-- logo 
							<div class="logo smooth-scroll">
								<a href="#banner"><img id="logo" src="images/logo.png" alt="Worthy"></a>
							</div>
							-->

							<!-- name-and-slogan -->
							<div class="logo-section smooth-scroll">
								<div class="brand"><a href="#banner">B<font size="6">&</font>R Studio</a></div>								
							</div>

						</div>
						<!-- header-left end -->

					</div>
					<div class="col-md-8">

						<!-- header-right start --> 
						<div class="header-right">

							<!-- main-navigation start --> 
							<div class="main-navigation animated">

								<!-- navbar start --> 
								<nav class="navbar navbar-default" role="navigation">
									<div class="container-fluid">

										<!-- Toggle get grouped for better mobile display -->
										<div class="navbar-header">
											<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
												<span class="sr-only">Toggle navigation</span>
												<span class="icon-bar"></span>
												<span class="icon-bar"></span>
												<span class="icon-bar"></span>
											</button>
										</div>

										<!-- Collect the nav links, forms, and other content for toggling -->
										<div class="collapse navbar-collapse scrollspy smooth-scroll" id="navbar-collapse-1">
											<ul class="nav navbar-nav navbar-right">
												<li><a href="index.html">首页</a></li>
												<li class="active"><a href="services.html">创建小目标</a></li>
												<li><a href="myaim.html">我的小目标</a></li>
												<li><a href="publicboard.html">公开计划</a></li>
												<li><a href="rules.html">详细规则</a></li>
											<!--	<li><a href="#about">关于我们</a></li>
												
												<li><a href="#portfolio">Portfolio</a></li>
												<li><a href="#team">Team</a></li>
												<li><a href="#price">Price</a></li>
											-->
												<li><a href="https://github.com/mjqin/OneBillion">Github</a></li>
											</ul>
										</div>

									</div>
								</nav>
								<!-- navbar end -->

							</div>
							<!-- main-navigation end -->

						</div>
						<!-- header-right end -->

					</div>
				</div>
			</div>
		</header>
		<!-- header end -->

		<!-- banner start --> 

		<div id="banner" class="banner">
			<div class="banner-image"></div>
			<div class="banner-caption">

			<div class="container no-view caption-data"  data-animation-effect="fadeIn">
				<h1 id="services" class="title text-center">创建小目标</h1>
				<div class="space"></div>
				<div class="space"></div>
				<div class="row">
					<div class="col-md-6">
						<h2 >Plan A</h2>
						<font size="4">
							<p>每日使用少量NAS签到</p>
							<p>达成目标，全额返还</p>
							<p>通过持续努力感受成功的喜悦！</p>
						</font>
						<div class="contact-form">
							<button id="setplana" class="btn cta-button"><font size="5">GO !</font></button>
						</div>
					</div>

					<div class="col-md-6">
						<h2>Plan B</h2>
							<font size="4">
								<p>先定一个小目标<font size="2">（预存适量NAS）</font></p>
								<p>每日签到，立即返还</p>
								<p>让奖励激发动力！</p>
							</font>
						<div class="contact-form">
							<button id="setplanb" class="btn cta-button"><font size="5">GO !</font></button>
						</div>
					</div>
				</div>
			</div>


			</div>
		</div>

    <div id="LoginBox">
        <div class="firstrow">
           创建 Plan <span id="plantype">A</span>
            <a href="javascript:void(0)" title="关闭窗口" class="close_btn" id="closeBtn">×</a>
        </div>
        <div class="followrow">
            用户昵称：<span class="inputBox" >
                <input type="text" id="nickname" class="text" placeholder="个人昵称，便于确定唯一身份" />
        </div>

        <div class="followrow">
            小目标名：<span class="inputBox">
                <input type="text" id="planname" class="text" placeholder="小目标名称" />
        </div>

        <div class="followrow">
            目标时长：<span class="inputBox">
                <input type="text" id="totaldays" class="text" placeholder="小目标持续总时长(天)" />
        </div>

        <div class="followrow">
            固定金额：<span class="inputBox">
                <input type="text" id="totalamount" class="text" placeholder="每天签到固定转账金额(NAS)" />
        </div>

        <div class="followrow">
            是否公开：
            <input type="radio" name="isPublic" value=1 checked> 公开   
            <input type="radio" name="isPublic" value=0 style="margin-left:50px"> 不公开
        </div>

        <div class="followrow">
            <a href="#" id="loginbtn">提交</a>
        </div>
    </div>

    <script type="text/javascript">

    	var NebPay = require("nebpay");
    	var nebPay = new NebPay();
    	var dappAddress = "n1v8e45CvAZB3Uj6gHFPm3aEveSuzLse3Qm";

    	if (typeof(webExtensionWallet) === "undefined") {
	        alert("请首先安装webExtensionWallet插件");
	    } 

    	$(function ($) {
			//弹出登录
			$("#setplana").on('click', function () {
				$("body").append("<div id='mask'></div>");
				$("#mask").addClass("mask").fadeIn("slow");
				$("#LoginBox").fadeIn("slow");
				$("#plantype").text("A");
				$("#totalamount").attr("placeholder", "每天签到固定转账金额(NAS)");

				$("#scene").css({ display: 'none' });
			});

			$("#setplanb").on('click', function () {
				$("body").append("<div id='mask'></div>");
				$("#mask").addClass("mask").fadeIn("slow");
				$("#LoginBox").fadeIn("slow");
				$("#plantype").text("B");
				$("#totalamount").attr("placeholder", "一次性投入金额总量(NAS)");
			});
	
			//文本框不允许为空---按钮触发
			$("#loginbtn").on('click', function () {
				var nickname = $("#nickname").val();
				var planname = $("#planname").val();
				var totaldays = $("#totaldays").val();
				var totalamount = $("#totalamount").val();

				if(nickname == "" || nickname == undefined || nickname == null){
					alert("请填写用户昵称！");
					return;
				}
				
				if(planname == "" || planname == undefined || planname == null){
					alert("请填写小目标名称！");
					return;
				}

				if(totaldays == "" || totaldays == undefined || totaldays == null){
					alert("请填写目标时长！");
					return;
				}

				if(totalamount == "" || totalamount == undefined || totalamount == null){
					alert("请填写固定金额！");
					return;
				}

				var daysInt = Number(totaldays);
				if( !Number.isInteger(daysInt) || daysInt <= 0){
					alert("目标时长请填入正整数！");
					return;
				}
				
				var amountInt = Number(totalamount);
				if(isNaN(amountInt) || amountInt <= 0){
					alert("固定金额请输入正整数！");
					return;
				}

				var planHash = sha256_digest(nickname+planname);
				var isPublic = $("input[name='isPublic']:checked").val();
			//	alert(isPublic);
				
				// send transaction
				var to = dappAddress;
				var value = "0";
				var callFunction = "createNewPlanone";
				var callArgs = "[\"" + nickname + "\",\"" + planname + "\"," + daysInt + "," + amountInt + "," + isPublic + ",\"" + planHash + "\"]";

				// alert(callArgs);

				var plantype = $("#plantype").text();


				if(plantype == "A"){
				//	alert("A");
					nebPay.call(to, value, callFunction, callArgs, {
			            listener: addPlanHandle
			        });
				}
				else{
				//	alert("B");
					callFunction = "createNewPlantwo";
					value = amountInt;
					nebPay.call(to, value, callFunction, callArgs, {
			            listener: addPlanHandle
			        });
				}
				$("#LoginBox").fadeOut("fast");
				$("#mask").css({ display: 'none' });
			});

		//关闭
			$(".close_btn").hover(function () { $(this).css({ color: 'black' }) }, function () { $(this).css({ color: '#999' }) }).on('click', function () {
				$("#LoginBox").fadeOut("fast");
				$("#mask").css({ display: 'none' });
			});
	});
    function addPlanHandle(resp){
    //	alert(JSON.stringify(resp));
     	if( resp.txhash != null) alert("目标创建成功！");
    	else alert("目标创建失败...请重试！");
    }

    </script>

		<!-- JavaScript --> 
		<script type="text/javascript" src="plugins/jquery.min.js"></script>
		<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="plugins/modernizr.js"></script>
		<script type="text/javascript" src="plugins/isotope/isotope.pkgd.min.js"></script>
		<script type="text/javascript" src="plugins/jquery.backstretch.min.js"></script>
		<script type="text/javascript" src="plugins/jquery.appear.js"></script>
		 <script src="contact/jqBootstrapValidation.js"></script>
		 <script src="contact/contact_me.js"></script>

		<!-- Custom Scripts -->
		<script type="text/javascript" src="js/custom.js"></script>

	</body>
</html>
